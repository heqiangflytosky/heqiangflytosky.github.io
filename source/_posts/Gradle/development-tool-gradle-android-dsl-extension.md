---
title: Gradle 使用指南 -- Android DSL 扩展
categories: Gradle
comments: true
keywords: Gradle
tags: [Gradle, 开发工具]
description: 介绍在Android开发过程中Gradle的一些常见命令和配置
date: 2016-3-8 10:00:00
---
## 概述

在前面博客[Gradle 使用指南 -- 基础配置](http://www.heqiangfly.com/2016/03/03/development-tool-gradle-command-config/) 中介绍了一些 Gradle 配置的基本命令，其中有一个名称为 `android`的函数不知道有没有引起大家的注意：

```
android {
    compileSdkVersion 23
    buildToolsVersion "23.0.1"
    defaultConfig {
        ......
    }
    buildTypes {
        release {
            ......
        }
    }
}
```

该函数接收闭包作为参数,然而其实在[Gradle的API文档](https://docs.gradle.org/current/dsl/org.gradle.api.invocation.Gradle.html)中是不存在这个函数的。那么 `android` 脚本怎么会出现在这里呢？ 答案就是最上面的 `apply plugin: 'com.android.application'`。这个插件提供了 Android 构建所需要的各种 script。 
[Android Plugin DSL Reference](http://google.github.io/android-gradle-dsl/)：Android 插件 DSL 扩展文档，各个版本的都有。
下面简单介绍一些 Android Plugin 对 Gradle 一些扩展的知识，没有涉及的地方可以参考官方文档。

## 扩展介绍

下面列出了各个插件使用的Gradle扩展类型：

| 类型 | 描述 |
| ------------- | ------------- |
| AppExtension | 对 `com.android.application` 插件的扩展 |
| LibraryExtension | 对 `com.android.library` 插件的扩展 |
| TestExtension | 对 `com.android.test` 插件的扩展 |
| FeatureExtension | 对 `com.android.feature` 插件的扩展，Gradle 3.0新增 |

下面是 Android Plugin 一些通用的 Script blocks，以上四种类型的扩展除了对下面的支持之外，还有自己类型的一些扩展。

| 方法（Script blocks） | 描述 |
| ------------- | ------------- |
|aaptOptions { } |Specifies options for the Android Asset Packaging Tool (AAPT)|
|adbOptions { }	|Specifies options for the Android Debug Bridge (ADB), such as APK installation options|
|buildTypes { }	|Encapsulates all build type configurations for this project.|
|compileOptions { }	|Specifies Java compiler options, such as the language level of the Java source code and generated bytecode.|
|dataBinding { }|Specifies options for the Data Binding Library.
|defaultConfig { }|	Specifies defaults for variant properties that the Android plugin applies to all build variants.|
|dexOptions { }	|Specifies options for the DEX tool, such as enabling library pre-dexing.|
|externalNativeBuild { }|Configures external native build using CMake or ndk-build.|
|jacoco { }	|Configuring JaCoCo using this block is deprecated.|
|lintOptions { }|Specifies options for the lint tool.|
|packagingOptions { }|	Specifies options and rules that determine which files the Android plugin packages into your APK.|
|productFlavors { }	|Encapsulates all product flavors configurations for this project.|
|signingConfigs { }	|Encapsulates signing configurations that you can apply to BuildType and ProductFlavor configurations.|
|sourceSets { }	|Encapsulates source set configurations for all variants.|
|splits { }	|Specifies configurations for building multiple APKs or APK splits.|
|testOptions { }|	Specifies options for how the Android plugin should run local and instrumented tests.| 

### AppExtension

下面仅列觉一下 `AppExtension` 的部分扩展：

| 方法（Script blocks） | 描述 |
| ------------- | ------------- |
| buildToolsVersion | Specifies the version of the SDK Build Tools to use when building your project.  |
| applicationVariants | Returns a collection of build variants that the app project includes.  |
| compileSdkVersion | Specifies the API level to compile your project against. The Android plugin requires you to configure this property.  |
| testVariants | Returns a collection of Android test build variants.  |
| ... | ... |

## 操作 Task

Android项目中会有大量相同的task，并且它们的名字基于Build Types和Product Flavor生成。
android 对象有两个属性：

 - applicationVariants（只适用于app plugin）
 - libraryVariants（只适用于library plugin）
 - featureVariants (只适用于feature plugin)
 - testVariants（三个plugin都适用）

这三个都会分别返回一个 `ApplicationVariant`、`LibraryVariant` 、 `TestVariant` 和 `FeatureVariant` 对象的 `DomainObjectCollection`。
[ApplicationVariant 源码](https://android.googlesource.com/platform/tools/build/+/8dca86a/gradle/src/main/groovy/com/android/build/gradle/internal/ApplicationVariant.groovy)
`DomainObjectCollection` 继承自 `Collection`，可以查看 [DomainObjectCollection文档说明](https://docs.gradle.org/4.2/javadoc/org/gradle/api/DomainObjectCollection.html)

**注意：** 使用这四个 `collection` 中的其中一个都会触发生成所有对应的task。这意味着使用 `collection` 之后不需要更改配置。

`DomainObjectCollection` 可以直接访问所有对象，或者通过过滤器进行筛选。

```
    android.applicationVariants.all {  variant ->
        def name = variant.name
        println "android "+name
    }
```


`DomainObjectCollection` 可以直接访问所有对象，或者通过过滤器进行筛选。

## 参考文档

http://google.github.io/android-gradle-dsl/current/

<!-- 
https://www.jianshu.com/p/cc98a6b4f52e
https://www.baidu.com/s?word=android.applicationVariants.all&tn=50000021_hao_pg&ie=utf-8&sc=UWd1pgw-pA7EnHc1FMfqnHRkPHD1njfLPW04nBuW5y99U1Dznzu9m1Yknj6knHRvrHf1&ssl_sample=s_4%2Cs_56&srcqid=1643360121714362939
http://blog.csdn.net/qinxiandiqi/article/details/37925629
http://blog.csdn.net/maosidiaoxian/article/details/39473191
https://www.jianshu.com/p/49bb7fb43f90
http://blog.csdn.net/qinxiandiqi/article/category/2394347
https://chaosleong.gitbooks.io/gradle-for-android/content/


Android Plugin DSL Reference
https://google.github.io/android-gradle-dsl/current/
http://blog.csdn.net/wangbaochu/article/details/51177672
-->
